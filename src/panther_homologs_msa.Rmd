---
title: "Multiple Sequence Alignment of GAT201 homologs"
author: "Edward Wallace"
date: "2023-10-10"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(cowplot)
library(Biostrings)
library(msa)
library(ggmsa)
library(here)
```

# Summary

This file takes selected fungal homologs of GAT201 with the same domain structure.
It performs a multiple sequence alignment of these homologs.

The output multiple sequence alignment can then be used to calculate a phylogenetic tree.

# Load gene data

```{r load_gene_data}
uniprot_df <- here::here("data","PTHR45658_subfamilies_uniprot_info_sequences.txt") %>% 
  readr::read_tsv(comment = "#")

uniprot_df
```


# Filter genes to those with only GATA domains

We exclude homologs with other domains, including white-collar 2 (wc-2, lreB, etc.) that have an additional PAS domain.

The relevant interpro domains are `IPR000679;IPR013088;`. These are two overlapping homologous superfamilies:

- [IPR000679 is Zinc finger, GATA-type](https://www.ebi.ac.uk/interpro/entry/InterPro/IPR000679/)
- [IPR013088 is Zinc finger, NHR/GATA-type](https://www.ebi.ac.uk/interpro/entry/InterPro/IPR013088/) is the larger superfamily.

```{r filter_by_domain}
gata_domains <- "IPR000679;IPR013088;"

uniprot_df_gataonly <- uniprot_df %>%
  dplyr::filter(InterPro == gata_domains)

uniprot_df_gataonly %>% 
  dplyr::select(GeneID, UniprotID, Organism, Length) %>%
  print(n = 40)
```

## Extract Sequences only and save to fasta

```{r extract_sequences}
seqs_full_gataonly <- Biostrings::AAStringSet(x = uniprot_df_gataonly$Sequence) %>%
  setNames(nm = uniprot_df_gataonly$UniprotID)

writeXStringSet(x = seqs_full_gataonly, 
                filepath = here::here("data","thirtysevenhomologs_1GATAdomainonly.fasta"))
```


# Multiple sequence alignment with Muscle

```{r calculate_msa_muscle_full}
seqs_full_gataonly_muscle <- msa(inputSeqs = seqs_full_gataonly, method = "Muscle") %>% 
  as("AAStringSet")

seqs_full_gataonly_muscle %>% 
  writeXStringSet(filepath = here::here("results","thirtysevenhomologs_1GATAdomainonly_muscle.fasta"))
```

# Multiple sequence alignment with MAFFT (on command line)

This uses default values.

```{r calculate_msa_mafftdefault}
mafft_command <- 
  paste("mafft", 
        here::here("data","thirtysevenhomologs_1GATAdomainonly.fasta"),
        ">",
        here::here("results","thirtysevenhomologs_1GATAdomainonly_mafftdefault.fasta"))

print(mafft_command)

system(mafft_command)

```

These multiple sequence alignments both (by visual inspection) fail to completely align the zinc-finger domains. So we have to try a different approach.


# Multiple sequence alignment with MAFFT using an alignment seed

This changes 3 values:

- `--localpair` to use the most accurate alignment
- `--seed nhrgatadomain_muscle.fasta` to seed with previous GATA-domain alignment from only 5 homologs
- `--ep 0.1` to increase the gap extension penalty and have a shorter overall alignment

```{r calculate_msa_mafft_seeded, message = TRUE, warning = TRUE}
mafft_command <- 
  paste("mafft", 
        "--localpair",
        "--seed", here::here("results", "nhrgatadomain_muscle.fasta"),
        "--ep 0.1",
        here::here("data","thirtysevenhomologs_1GATAdomainonly.fasta"),
        ">",
        here::here("results","thirtysevenhomologs_1GATAdomainonly_mafftseeded.fasta"))

print(mafft_command)

# check which version of mafft is being run
system("mafft --version")
# run the command
system(mafft_command)

# load the sequences back into R
seqs_full_gataonly_mafft <-
  readAAStringSet(here::here("results","thirtysevenhomologs_1GATAdomainonly_mafftseeded.fasta"))
```

Visual inspection of the alignment showed good alignment of the GATA domain, from position 1602-1636.

```{r display_gatadomain_mafft, fig.height = 4, fig.width = 4}
seqs_full_gataonly_mafft %>%
  subseq(start = 1602, end = 1636) %>%
  ggmsa::ggmsa(color = "Clustal", seq_name = TRUE ) + 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 7))
```



# TO DO

- Add mafft terminal output to .html??
- Make a phylogenetic tree and plot it
- Select most relevant homologs
- Plot a MSA of select GATA domains
- Update README file to reflect new contents


# Session info for reproducibility

```{r session_info}
sessionInfo()
```
